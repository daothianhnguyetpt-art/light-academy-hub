
# Káº¿ Hoáº¡ch: Modal ThÃ´ng BÃ¡o Chuyá»ƒn HÆ°á»›ng Light Law

## Tá»•ng Quan

ThÃªm modal thÃ´ng bÃ¡o nháº¹ nhÃ ng, dá»… thÆ°Æ¡ng khi user Ä‘Äƒng nháº­p mÃ  chÆ°a accept Light Law. Modal giáº£i thÃ­ch tÃ¬nh huá»‘ng vÃ  cho user lá»±a chá»n trÆ°á»›c khi redirect.

## Luá»“ng Má»›i

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Ä‘Äƒng nháº­p thÃ nh cÃ´ng (Google / Email / Wallet)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ LightLawGuard kiá»ƒm tra:       â”‚
              â”‚ profile.light_law_accepted_at â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚              â”‚
                   CÃ“             CHÆ¯A
                     â”‚              â”‚
                     â–¼              â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ VÃ o app      â”‚   â”‚ âœ¨ HIá»†N MODAL        â”‚
          â”‚ bÃ¬nh thÆ°á»ng  â”‚   â”‚ THÃ”NG BÃO âœ¨         â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â–¼                                   â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Click OK   â”‚                    â”‚ ÄÄƒng xuáº¥t &    â”‚
              â”‚            â”‚                    â”‚ Tiáº¿p tá»¥c Guest â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚                                   â”‚
                     â–¼                                   â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Navigate   â”‚                    â”‚ signOut() â†’    â”‚
              â”‚ /light-law â”‚                    â”‚ á» trang hiá»‡n   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚ táº¡i vá»›i Guest  â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Thiáº¿t Káº¿ Modal

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                     â”‚
â”‚                    ğŸŒŸ âœ¨ ğŸŒŸ                         â”‚
â”‚                                                     â”‚
â”‚              ChÃ o má»«ng báº¡n Ä‘áº¿n vá»›i                  â”‚
â”‚              FUN Ecosystem! ğŸ’«                      â”‚
â”‚                                                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                     â”‚
â”‚   Äá»ƒ trá»Ÿ thÃ nh thÃ nh viÃªn chÃ­nh thá»©c, báº¡n cáº§n      â”‚
â”‚   Ä‘á»“ng Ã½ vá»›i Luáº­t Ãnh SÃ¡ng cá»§a chÃºng tÃ´i.          â”‚
â”‚                                                     â”‚
â”‚   Báº¡n sáº½ Ä‘Æ°á»£c chuyá»ƒn Ä‘áº¿n trang Luáº­t Ãnh SÃ¡ng       â”‚
â”‚   Ä‘á»ƒ tÃ¬m hiá»ƒu vÃ  xÃ¡c nháº­n. ğŸ•Šï¸                      â”‚
â”‚                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  âœ¨ OK, ÄÆ°a con Ä‘áº¿n Ãnh SÃ¡ng               â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                     â”‚
â”‚          ÄÄƒng xuáº¥t & Tiáº¿p tá»¥c á»Ÿ cháº¿ Ä‘á»™ KhÃ¡ch       â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Chi Tiáº¿t Ká»¹ Thuáº­t

### File 1: Táº¡o má»›i `src/components/auth/LightLawRedirectModal.tsx`

Modal nháº¹ nhÃ ng, tÆ°Æ¡i sÃ¡ng vá»›i:
- Emoji vÃ  icon dá»… thÆ°Æ¡ng
- Gradient background nháº¹
- Ná»™i dung ngáº¯n gá»n, thÃ¢n thiá»‡n
- NÃºt chÃ­nh: "OK, ÄÆ°a con Ä‘áº¿n Ãnh SÃ¡ng" (mÃ u gold, ná»•i báº­t)
- NÃºt phá»¥: "ÄÄƒng xuáº¥t & Tiáº¿p tá»¥c á»Ÿ cháº¿ Ä‘á»™ KhÃ¡ch" (text link nháº¹)

```typescript
interface LightLawRedirectModalProps {
  open: boolean;
  onConfirm: () => void;        // Navigate to /light-law
  onContinueAsGuest: () => void; // Sign out & stay as guest
}

export function LightLawRedirectModal({
  open,
  onConfirm,
  onContinueAsGuest,
}: LightLawRedirectModalProps) {
  return (
    <Dialog open={open} onOpenChange={() => {}}>
      <DialogContent 
        className="sm:max-w-md"
        onPointerDownOutside={(e) => e.preventDefault()}
        onEscapeKeyDown={(e) => e.preventDefault()}
        // áº¨n nÃºt X - modal báº¯t buá»™c chá»n 1 trong 2
      >
        {/* Header vá»›i emoji */}
        <div className="text-center mb-4">
          <div className="text-3xl mb-2">ğŸŒŸ âœ¨ ğŸŒŸ</div>
          <DialogTitle className="text-xl font-display">
            ChÃ o má»«ng báº¡n Ä‘áº¿n vá»›i
            <br />
            <span className="text-gradient-gold">FUN Ecosystem!</span> ğŸ’«
          </DialogTitle>
        </div>

        {/* Ná»™i dung */}
        <div className="text-center space-y-3 text-muted-foreground">
          <p>
            Äá»ƒ trá»Ÿ thÃ nh thÃ nh viÃªn chÃ­nh thá»©c, báº¡n cáº§n Ä‘á»“ng Ã½ vá»›i 
            <span className="text-foreground font-medium"> Luáº­t Ãnh SÃ¡ng </span>
            cá»§a chÃºng tÃ´i.
          </p>
          <p className="text-sm">
            Báº¡n sáº½ Ä‘Æ°á»£c chuyá»ƒn Ä‘áº¿n trang Luáº­t Ãnh SÃ¡ng Ä‘á»ƒ tÃ¬m hiá»ƒu vÃ  xÃ¡c nháº­n. ğŸ•Šï¸
          </p>
        </div>

        {/* Buttons */}
        <div className="mt-6 space-y-3">
          <Button
            onClick={onConfirm}
            className="w-full btn-primary-gold"
          >
            <Sparkles className="w-4 h-4 mr-2" />
            OK, ÄÆ°a con Ä‘áº¿n Ãnh SÃ¡ng
          </Button>
          
          <button
            onClick={onContinueAsGuest}
            className="w-full text-sm text-muted-foreground hover:text-foreground transition-colors py-2"
          >
            ÄÄƒng xuáº¥t & Tiáº¿p tá»¥c á»Ÿ cháº¿ Ä‘á»™ KhÃ¡ch
          </button>
        </div>
      </DialogContent>
    </Dialog>
  );
}
```

### File 2: Cáº­p nháº­t `src/components/auth/LightLawGuard.tsx`

Thay vÃ¬ redirect ngay, hiá»‡n modal trÆ°á»›c:

```typescript
import { ReactNode, useEffect, useState } from "react";
import { useNavigate, useLocation } from "react-router-dom";
import { useAuth } from "@/hooks/useAuth";
import { useProfile } from "@/hooks/useProfile";
import { LightLawRedirectModal } from "./LightLawRedirectModal";

export function LightLawGuard({ children }: { children: ReactNode }) {
  const { user, loading: authLoading, signOut } = useAuth();
  const { profile, loading: profileLoading } = useProfile();
  const navigate = useNavigate();
  const location = useLocation();
  const [showModal, setShowModal] = useState(false);

  useEffect(() => {
    if (authLoading || profileLoading) return;

    // User Ä‘Äƒng nháº­p nhÆ°ng chÆ°a accept Light Law
    if (user && profile && !profile.light_law_accepted_at) {
      // KhÃ´ng hiá»‡n modal náº¿u Ä‘ang á»Ÿ /light-law
      if (location.pathname !== "/light-law") {
        setShowModal(true);
      }
    } else {
      setShowModal(false);
    }
  }, [user, profile, authLoading, profileLoading, location.pathname]);

  const handleConfirm = () => {
    setShowModal(false);
    navigate("/light-law");
  };

  const handleContinueAsGuest = async () => {
    setShowModal(false);
    await signOut();
    // á» láº¡i trang hiá»‡n táº¡i vá»›i tÆ° cÃ¡ch guest
  };

  return (
    <>
      {children}
      <LightLawRedirectModal
        open={showModal}
        onConfirm={handleConfirm}
        onContinueAsGuest={handleContinueAsGuest}
      />
    </>
  );
}
```

## Äáº·c Äiá»ƒm Modal

| Yáº¿u tá»‘ | Chi tiáº¿t |
|--------|----------|
| **Tone** | ThÃ¢n thiá»‡n, áº¥m Ã¡p, khÃ´ng Ä‘e dá»a |
| **Emoji** | ğŸŒŸ âœ¨ ğŸ’« ğŸ•Šï¸ - tÆ°Æ¡i sÃ¡ng, tÃ­ch cá»±c |
| **MÃ u sáº¯c** | Gold gradient cho highlight, ná»n sÃ¡ng |
| **NÃºt chÃ­nh** | "OK, ÄÆ°a con Ä‘áº¿n Ãnh SÃ¡ng" - gold, ná»•i báº­t |
| **NÃºt phá»¥** | Text link nháº¹ nhÃ ng, khÃ´ng Ã¡p lá»±c |
| **KhÃ´ng cÃ³ nÃºt X** | Báº¯t buá»™c chá»n 1 trong 2 options |

## CÃ¡c File Cáº§n Thay Äá»•i

| File | HÃ nh Ä‘á»™ng |
|------|-----------|
| `src/components/auth/LightLawRedirectModal.tsx` | **Táº¡o má»›i** |
| `src/components/auth/LightLawGuard.tsx` | ThÃªm state modal + handlers |

## Káº¿t Quáº£ Mong Äá»£i

| TrÆ°á»ng há»£p | HÃ nh vi |
|------------|---------|
| User má»›i Ä‘Äƒng nháº­p | Hiá»‡n modal dá»… thÆ°Æ¡ng thÃ´ng bÃ¡o |
| User click "OK" | ÄÃ³ng modal â†’ Navigate /light-law |
| User click "ÄÄƒng xuáº¥t & Guest" | ÄÃ³ng modal â†’ signOut() â†’ á» láº¡i trang |
| User cÅ© (Ä‘Ã£ accept) | KhÃ´ng hiá»‡n modal |
| User Ä‘ang á»Ÿ /light-law | KhÃ´ng hiá»‡n modal (trÃ¡nh loop) |

## Thá»i Gian Thá»±c Hiá»‡n

Æ¯á»›c tÃ­nh: 10 phÃºt
